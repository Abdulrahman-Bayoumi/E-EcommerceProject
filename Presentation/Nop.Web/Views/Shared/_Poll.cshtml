@model PollModel
<div class="poll" id="poll-block-@(Model.Id)">
    <h4 style="font-size: 18px; font-weight: 600; color: #333; margin-bottom: 20px;">@Model.Name</h4>
    @if (Model.AlreadyVoted)
    {
        <ul class="list-unstyled" style="margin: 0; padding: 0;">
            @foreach (var item in Model.Answers)
            {
                <li class="mb-3" style="padding: 10px; background: #f8f9fa; border-radius: 4px;">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span style="font-weight: 500; color: #333;">@item.Name</span>
                        <span style="font-size: 14px; color: #666;">@item.PercentOfTotalVotes.ToString("0.0")%</span>
                    </div>
                    <div class="progress" style="height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: @item.PercentOfTotalVotes%;" aria-valuenow="@item.PercentOfTotalVotes" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <small class="text-muted" style="font-size: 12px;">@item.NumberOfVotes @T("Polls.Votes")</small>
                </li>
            }
        </ul>
        <div class="mt-3 text-center" style="padding: 10px; background: #e7f3ff; border-radius: 4px;">
            <strong style="color: #007bff;">@string.Format(T("Polls.TotalVotes").Text, Model.TotalVotes)</strong>
        </div>
    }
    else
    {
        <ul class="list-unstyled" style="margin: 0 0 20px 0; padding: 0;">
            @foreach (var item in Model.Answers)
            {
                <li class="mb-2" style="padding: 10px; border: 1px solid #e0e0e0; border-radius: 4px; transition: all 0.2s ease;"
                    onmouseover="this.style.borderColor='#007bff'; this.style.backgroundColor='#f8f9fa';"
                    onmouseout="this.style.borderColor='#e0e0e0'; this.style.backgroundColor='white';">
                    <div class="custom-control custom-radio">
                        <input type="radio" id="pollanswers-@(item.Id)" name="pollanswers-@(Model.Id)" value="@item.Id" class="custom-control-input" />
                        <label class="custom-control-label" for="pollanswers-@(item.Id)" style="cursor: pointer; font-weight: 500; color: #333;">
                            @item.Name
                        </label>
                    </div>
                </li>
            }
        </ul>
        <div class="buttons text-center">
            <button type="button" id="vote-poll-@(Model.Id)" class="btn btn-primary vote-poll-button">
                <i class="fas fa-vote-yea mr-1"></i>@T("Polls.Vote")
            </button>
            <span id="poll-voting-progress-@(Model.Id)" style="display: none;" class="please-wait ml-2">
                <i class="fas fa-spinner fa-spin mr-1"></i>@T("Common.Wait")
            </span>
        </div>
        <div class="poll-vote-error alert alert-danger mt-2" id="block-poll-vote-error-@(Model.Id)" style="display:none">
        </div>
        <script asp-location="Footer">
            $(function() {
                $('#vote-poll-@(Model.Id)').on('click', function () {
                    var pollAnswerId = $("input:radio[name=pollanswers-@(Model.Id)]:checked").val();
                    if (typeof (pollAnswerId) == 'undefined') {
                        alert('@Html.Raw(JavaScriptEncoder.Default.Encode(T("Polls.SelectAnswer").Text))');
                    }
                    else {
                        var voteProgress = $("#poll-voting-progress-@(Model.Id)");
                        voteProgress.show();

                        var postData = {
                          "pollAnswerId": pollAnswerId
                        };
                        addAntiForgeryToken(postData);

                        $.ajax({
                            cache: false,
                            type: "POST",
                            url: "@(Url.RouteUrl(NopRouteNames.Ajax.POLL_VOTE))",
                            data: postData,
                            success: function (data, textStatus, jqXHR) {
                                if (data.error) {
                                    $("#block-poll-vote-error-@(Model.Id)").html(data.error);
                                    $('#block-poll-vote-error-@(Model.Id)').fadeIn("slow").delay(2000).fadeOut("slow");
                                }
                                if (data.html) {
                                    $("#poll-block-@(Model.Id)").replaceWith(data.html);
                                }
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert('Failed to vote.');
                            },
                            complete: function (jqXHR, textStatus) {
                                voteProgress.hide();
                            }
                        });
                    }
                    return false;
                });
            });
        </script>
    }
</div>
